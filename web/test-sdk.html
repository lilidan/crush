<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDK Test - Browser Crush</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .success { border-color: #28a745; background: #f8fff9; }
        .error { border-color: #dc3545; background: #fff8f8; }
        .pending { border-color: #ffc107; background: #fffbf0; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        
        input[type="text"], input[type="password"] {
            width: 300px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Browser Crush SDK Test</h1>
        <p>This page tests the new SDK-based LLM client implementation.</p>
        
        <div id="sdk-status" class="test-section pending">
            <h3>SDK Loading Status</h3>
            <p id="sdk-status-text">Loading...</p>
        </div>
        
        <div class="test-section">
            <h3>API Key Configuration</h3>
            <div>
                <label>OpenAI API Key:</label><br>
                <input type="password" id="openai-key" placeholder="sk-...">
                <button onclick="testOpenAI()">Test OpenAI</button>
            </div>
            <div>
                <label>Anthropic API Key:</label><br>
                <input type="password" id="anthropic-key" placeholder="sk-ant-...">
                <button onclick="testAnthropic()">Test Anthropic</button>
            </div>
        </div>
        
        <div id="test-results" class="test-section">
            <h3>Test Results</h3>
            <div id="results-log" class="log">No tests run yet...</div>
        </div>
        
        <div class="test-section">
            <h3>Streaming Test</h3>
            <button onclick="testStreaming()">Test Streaming</button>
            <div id="streaming-output" class="log" style="display: none;"></div>
        </div>
    </div>

    <!-- Load required scripts -->
    <script src="js/core/types.js"></script>
    <script src="js/core/utils.js"></script>
    <script src="js/llm/sdk-loader.js"></script>
    <script src="js/llm/llm-client-sdk.js"></script>

    <script>
        let testLog = '';
        
        function log(message) {
            testLog += new Date().toLocaleTimeString() + ': ' + message + '\n';
            document.getElementById('results-log').textContent = testLog;
        }
        
        function updateSDKStatus(status, isSuccess = false) {
            const statusDiv = document.getElementById('sdk-status');
            const statusText = document.getElementById('sdk-status-text');
            
            statusText.textContent = status;
            statusDiv.className = `test-section ${isSuccess ? 'success' : 'pending'}`;
        }
        
        async function initializeSDKs() {
            try {
                updateSDKStatus('Loading SDK loader...');
                
                if (!window.sdkLoader) {
                    throw new Error('SDK Loader not available');
                }
                
                updateSDKStatus('Preloading SDKs...');
                const availableSDKs = await window.sdkLoader.preloadSDKs(['openai', 'anthropic']);
                
                let statusMsg = 'SDK Status:\n';
                statusMsg += `OpenAI: ${availableSDKs.openai ? '✅ Available' : '❌ Not available'}\n`;
                statusMsg += `Anthropic: ${availableSDKs.anthropic ? '✅ Available' : '❌ Not available'}\n`;
                statusMsg += `Ollama: ${availableSDKs.ollama ? '✅ Available' : '❌ Not available'}`;
                
                updateSDKStatus(statusMsg, true);
                log('SDKs initialized successfully');
                
            } catch (error) {
                updateSDKStatus(`Failed to load SDKs: ${error.message}`);
                log(`SDK initialization error: ${error.message}`);
            }
        }
        
        async function testOpenAI() {
            const apiKey = document.getElementById('openai-key').value.trim();
            if (!apiKey) {
                alert('Please enter your OpenAI API key');
                return;
            }
            
            try {
                log('Testing OpenAI SDK...');
                
                const client = await window.sdkLoader.createLLMClient('openai', apiKey, {
                    model: 'gpt-4o-mini'
                });
                
                log('OpenAI client created successfully');
                
                const response = await client.generateWithTools('Say "Hello from OpenAI SDK!" to test the connection.');
                
                log(`OpenAI Response: ${response.text || response.content || 'No content'}`);
                log('✅ OpenAI test passed!');
                
            } catch (error) {
                log(`❌ OpenAI test failed: ${error.message}`);
            }
        }
        
        async function testAnthropic() {
            const apiKey = document.getElementById('anthropic-key').value.trim();
            if (!apiKey) {
                alert('Please enter your Anthropic API key');
                return;
            }
            
            try {
                log('Testing Anthropic SDK...');
                
                const client = await window.sdkLoader.createLLMClient('anthropic', apiKey, {
                    model: 'claude-3-haiku-20240307'
                });
                
                log('Anthropic client created successfully');
                
                const response = await client.generateWithTools('Say "Hello from Anthropic SDK!" to test the connection.');
                
                log(`Anthropic Response: ${response.text || response.content || 'No content'}`);
                log('✅ Anthropic test passed!');
                
            } catch (error) {
                log(`❌ Anthropic test failed: ${error.message}`);
            }
        }
        
        async function testStreaming() {
            const openaiKey = document.getElementById('openai-key').value.trim();
            const anthropicKey = document.getElementById('anthropic-key').value.trim();
            
            if (!openaiKey && !anthropicKey) {
                alert('Please enter at least one API key to test streaming');
                return;
            }
            
            const streamingOutput = document.getElementById('streaming-output');
            streamingOutput.style.display = 'block';
            streamingOutput.textContent = '';
            
            try {
                let client;
                let provider;
                
                if (openaiKey) {
                    provider = 'openai';
                    client = await window.sdkLoader.createLLMClient('openai', openaiKey, {
                        model: 'gpt-4o-mini'
                    });
                } else {
                    provider = 'anthropic';
                    client = await window.sdkLoader.createLLMClient('anthropic', anthropicKey, {
                        model: 'claude-3-haiku-20240307'
                    });
                }
                
                log(`Testing ${provider} streaming...`);
                streamingOutput.textContent = `Testing ${provider} streaming...\n\n`;
                
                let fullResponse = '';
                for await (const chunk of client.generateStream('Write a short poem about AI and coding in exactly 4 lines.')) {
                    fullResponse += chunk;
                    streamingOutput.textContent = `Testing ${provider} streaming...\n\n${fullResponse}`;
                }
                
                log(`✅ ${provider} streaming test completed!`);
                
            } catch (error) {
                log(`❌ Streaming test failed: ${error.message}`);
                streamingOutput.textContent += `\n\nError: ${error.message}`;
            }
        }
        
        // Initialize on page load
        window.addEventListener('load', initializeSDKs);
    </script>
</body>
</html>